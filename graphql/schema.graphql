"A datetime string with format `Y-m-d H:i:s`, e.g. `2018-05-23 13:43:32`."
scalar DateTime @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

type User {
    id: ID!
    username: String!
    email: String!
    email_verified_at: DateTime
    created_at: DateTime!
    updated_at: DateTime!
    role: Role! @hasOne
}

type Media {
    id: ID!
    title: String!
    duration: Int!
    is_video: Boolean!
    image: String
    source: String!
    album: Album @belongsTo
    artists: [Artist!] @belongsToMany
}

type Album {
    id: ID!
    title: String!
    summary: String!
    image: String
    artists: [Artist!]! @hasMany
    media: [Media!]! @hasMany
}

type Artist {
    id: ID!
    name: String!
    summary: String!
    image: String
    albums: [Album!]! @belongsToMany
    media: [Media!]! @belongsToMany
}

type Request {
    id: ID!
    media: Media! @belongsTo
    votes: [Vote!]! @belongsTo
    requested_at: DateTime!
    played_at: DateTime
    vote_count: Int! @count(model: "Vote")
}

type Vote {
    request: Request! @belongsTo
    user: User! @belongsTo
}

type Role {
    id: ID!
    name: String!
    description: String!
    protected: Boolean!
    permissions: [Permission!]! @hasMany
}

type Permission {
    id: ID!
    name: String!
    description: String!
}

union SearchResult = Media | Album | Artist

type Query {
    user(
        id: ID @eq @rules(apply: ["prohibits:username", "required_without:username"])
        username: String @eq @rules(apply: ["prohibits:id", "required_without:id", "username"])
    ): User @find

    users(
        username: String! @where(operator: "like")
    ): [User!]! @paginate(defaultCount: 10)

    media(id: ID! @eq): Media @find
    medias(
        title: String! @where(operator: "like")
    ): [Media!]! @paginate(defaultCount: 10)

    artist(id: ID! @eq): Artist @find
    artists(
        name: String! @where(operator: "like")
    ): [Artist!]! @paginate(defaultCount: 10)

    album(id: ID! @eq): Album @find
    albums(
        title: String! @where(operator: "like")
    ): [Album!]! @paginate(defaultCount: 10)

    request(id: ID! @eq): Request @find
    requests: [Request!]! @paginate(defaultCount: 20)

    role(id: ID! @eq): Role @find
    roles: [Role!]! @paginate(defaultCount: 10)

    permission(id: ID! @eq): Permission @find
    permissions(
        name: String! @where(operator: "like")
    ): [Permission!]! @paginate(defaultCount: 20)
}
